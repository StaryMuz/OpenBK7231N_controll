name: Night Relay Guard

on:
  workflow_dispatch:
  schedule:
    # zimní čas – 6:50–18:50 českého času, běh následujících 45 minut
    - cron: "10 19-5 * 11,12,1,2 *"
    - cron: "10 19-5 25-31 10 *"
    - cron: "10 19-5 1-24 3 *"
    # letní čas – 4:50–21:50 českého času, běh následujících 45 minut
    - cron: "10 20-1 * 4,5,6,7,8,9 *"
    - cron: "10 20-1 1-24 10 *"
    - cron: "10 20-1 25-31 3 *"
  
jobs:
  guard:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install paho-mqtt pytz

      - name: Run night guard
        env:
          MQTT_HOST: ${{ secrets.MQTT_HOST }}
          MQTT_USER: ${{ secrets.MQTT_USER }}
          MQTT_PASS: ${{ secrets.MQTT_PASS }}
        run: |
          python night_guard.py
